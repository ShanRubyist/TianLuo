Vue.component('refresh-history-dialog', {
    props: ['refresh_history_dialog_visible', 'setting_id'],
    data: function () {
        return {
            histories: [],
            page: 0,
        }
    },
    watch: {
        setting_id: function () {
            this.histories = [];
            this.page = 1;
        },
        page: function (new_page, old_page) {
            if (new_page == 0) { return ; }

            var that = this
            axios.get('<%= histories_path %>', {
                headers: {
                    'Accept': 'application/json'
                },
                params: {
                    setting_id: this.setting_id,
                    page: this.page,
                }
            }).then(function (reason) {
                that.append_histories(reason.data);
            }).catch(function (reason) {
            })
        }
    },
    methods: {
        close: function () {
            this.$emit('close');
            
            // 关闭时设为0是为了显示时可以设为1,可以触发page更新监听器
            this.page = 0;
        },
        append_histories: function (data) {
            var that = this;

            data.forEach(function (obj, index) {
                that.histories.push(obj)
            })
        },
        show_more: function () {
            this.page += 1;
        },
        select_timeline_status: function (status) {
            var color = null;
            switch (status) {
                case 'enqueue', 'enqueued':
                    color = 'gray'
                    break;
                case 'performing':
                    color = 'yellow'
                    break;
                case 'fail':
                    color = 'red';
                    break;
                case 'success':
                    color = 'green'
                    break;
                default:
                    break;
            }
            return color;
        }
    },
    template: '<%= import_partial('home/all/history/refresh_history_dialog_templ') %>'
})